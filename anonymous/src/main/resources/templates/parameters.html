<html>
<title>Anonymous FrontEnd</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
<script src="js/models/Settings.js"></script>
<script src="js/hellper/CreateDynamicTable.js"></script>
<!-- <link rel="stylesheet" href="css/bootstrap.css"> -->
<!-- <link rel="stylesheet" href="css/bootstrap-theme.css"> -->
<link rel="stylesheet" href="css/tailwind.css">
<link href='https://unpkg.com/css.gg@2.0.0/icons/css/trash.css' rel='stylesheet'>
<link href='https://unpkg.com/css.gg@2.0.0/icons/css/add.css' rel='stylesheet'>
</head>

<body class="bg-slate-50">
<div th:replace="navBar :: navBar"></div>
<div class="p-5 bg-slate-50">
      <h3 class="text-3xl font-semibold m-5">Parameters</h3>
<div id="columns"></div>
    <input type="text" id="process" placeholder="Filter by process">
    <input type="text" id="institution" placeholder="Filter by Institution">
    <input type="text" id="dateReference" placeholder="Filter by Date reference">
    <br><br>
    <table id="grid">
        <thead>
            <tr id="headerRow"></tr>
        </thead>
        <tbody id="gridBody"></tbody>
    </table>

    <div id="editForm" style="display: none;">
        <h2>Edit Item</h2>
        <form id="itemForm">
            <input type="hidden" id="itemId">
            <div id="formFields"></div>
            <br>
            <button type="submit">Update</button>
        </form>
    </div>

    <script>
        const apiUrl = ' http://localhost:8080/restParameters'; // Replace with your API endpoint

              
        class GridController {
            constructor() {
                this.columns = [
                    { name: 'process', label: 'Process' },
                    { name: 'jobName', label: 'Job name' },
                    { name: 'dateReference', label: 'Date reference' },
                    { name: 'seqId', label: 'Seq ID' },
                    { name: 'fromParameter', label: 'From' },
                    { name: 'toParameter', label: 'To' },
                    { name: 'status', label: 'Status' },
                    { name: 'dateStart', label: 'Start' },
                    { name: 'dateEnd', label: 'End' },
                    { name: 'duration', label: 'Duration' },
                    { name: 'outputType', label: 'Output type' },
                    { name: 'institutionNumber', label: 'Institution' }
                    // Add more columns as needed
                ];
                this.grid = document.getElementById('grid');
                this.gridBody = document.getElementById('gridBody');
                this.editForm = document.getElementById('editForm');
                this.itemForm = document.getElementById('itemForm');
                this.itemForm.addEventListener('submit', this.updateItem.bind(this));
                this.fetchData();
            }

            createColumns() {
                const headerRow = document.getElementById('headerRow');

                for (const column of this.columns) {
                    const th = document.createElement('th');
                    th.textContent = column.label;
                    headerRow.appendChild(th);
                }
            }

            fetchData() {
                const processFilter = document.getElementById('process').value.trim();
                const institutionFilter = document.getElementById('institution').value.trim();
                const dateReferenceFilter = document.getElementById('dateReference').value.trim();

                const url = `${apiUrl}?process=${processFilter}&institution=${institutionFilter}&dateReference=${dateReferenceFilter}`;

                fetch(url)
                    .then(response => response.json())
                    .then(data => this.displayData(data))
                    .catch(error => console.error('Error:', error));
            }

            displayData(data) {
            	
            	let counter = 0;
                this.gridBody.innerHTML = '';

                for (const item of data) {

                    const row = document.createElement('tr');
                    
                    for (const column of this.columns) {
                        const cell = document.createElement('td');
                        cell.textContent = item[column.name];
                        cell.value=item[column.name];
                        cell.id=column.name+counter;
                        row.appendChild(cell);
                    }

                    const actionsCell = document.createElement('td');
                    const editBtn = document.createElement('button');
                    editBtn.textContent = 'Edit';
                    editBtn.dataset.itemId = counter;
                    editBtn.addEventListener('click', this.editRow.bind(this));
                    actionsCell.appendChild(editBtn);

                    const deleteBtn = document.createElement('button');
                    deleteBtn.textContent = 'Delete';
                    deleteBtn.dataset.itemId = counter;
                    deleteBtn.addEventListener('click', this.deleteRow.bind(this));
                    actionsCell.appendChild(deleteBtn);

                    row.appendChild(actionsCell);
                    this.gridBody.appendChild(row);

                    counter++;
                }
            }

            editRow(event) {
                
                const itemId = event.target.dataset.itemId;
                const item = this.getItemById(itemId);                
                if (item) {
                    this.showEditForm(item);
                }
            }

            getItemById(itemId) {
                // Fetch the item from the API or your data source
                // Replace with your REST API request or data retrieval logic
                
                
                const item = {
                    process: document.getElementById('process'+itemId).value,
                    jobName: document.getElementById('jobName'+itemId).value,
                    dateReference: document.getElementById('dateReference'+itemId).value,
                    seqId: document.getElementById('seqId'+itemId).value,
                    fromParameter: document.getElementById('fromParameter'+itemId).value,
                    toParameter: document.getElementById('toParameter'+itemId).value,
                    status: document.getElementById('status'+itemId).value,
                    dateStart: document.getElementById('dateStart'+itemId).value,
                    dateEnd: document.getElementById('dateEnd'+itemId).value,
                    duration: document.getElementById('duration'+itemId).value,
                    outputType: document.getElementById('outputType'+itemId).value,
                    institutionNumber: document.getElementById('institutionNumber'+itemId).value,       
                  
                };
			
                return item;
            }

            showEditForm(item) {
                this.itemForm.reset();
               
                const formFields = document.getElementById('formFields');
                formFields.innerHTML = '';

                for (const column of this.columns) {
                    const label = document.createElement('label');
                    label.textContent = column.label;
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.name = column.name;
                    input.value = item[column.name];
                    formFields.appendChild(label);
                    formFields.appendChild(input);
                }

                this.editForm.style.display = 'block';
            }

            updateItem(event) {
                event.preventDefault();

                const formData = new FormData(this.itemForm);
                const data = {};

                for (const [name, value] of formData.entries()) {
                    data[name] = value;
                }
                
                const url = `${apiUrl}`;

                fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                    .then(response => response.json())
                    .then(updatedItem => {
                        
                        this.hideEditForm();
                        this.fetchData();
                    })
                    .catch(error => console.error('Error:', error));
            }

            deleteRow(event) {
                           

                const itemId = event.target.dataset.itemId;
                const item = this.getItemById(itemId); 

                if (confirm('Are you sure you want to delete this item?')) {
                    const url = `${apiUrl}`;

                    fetch(url, {
                        method: 'DELETE',
                        	headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(item)
                    })
                        .then(response => {
                            console.log('Deleted item:', itemId);
                            this.fetchData();
                        })
                        .catch(error => console.error('Error:', error));
                }
            }

            hideEditForm() {
                this.editForm.style.display = 'none';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const gridController = new GridController();
            document.getElementById('process').addEventListener('input', gridController.fetchData.bind(gridController));
            document.getElementById('institution').addEventListener('input', gridController.fetchData.bind(gridController));
            document.getElementById('dateReference').addEventListener('input', gridController.fetchData.bind(gridController));

            gridController.createColumns();
        });
    </script>
</div>
</body>

</html>